<!DOCTYPE html>

<html lang="zh-CN" class="fullscreen-bg">

<head>
	<title>浙江省高考志愿推荐系统</title>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="高考 志愿 填写 推荐">
	<meta name="description" content="高考志愿填写推荐">
	<meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="expires" content="0">   
	
	<!-- vendor css -->
	<link rel="stylesheet" href="assets/css/bootstrap.css">
	<link rel="stylesheet" href="assets/vendor/font-awesome/css/font-awesome.min.css">
	<link rel="stylesheet" href="assets/vendor/linearicons/style.css">
	
	<!-- main css from tmp-->
	<link rel="stylesheet" href="assets/css/main.css">
 
	<!-- ICONS 
	<link rel="apple-touch-icon" sizes="76x76" href="assets/img/apple-icon.png">
	<link rel="icon" type="image/png" sizes="96x96" href="assets/img/favicon.png">
	-->
	
</head>

<body class="layout-fullwidth  text-center ">
<!--navbar-collapse -->
    <nav class="navbar  navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand"  >浙江省高考志愿推荐系统</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse navbar-right">
          <p>
          	&nbsp;
          <a class="btn btn-primary " href="login.html" role="button">返回 &raquo;</a>
          </p>
        </div>
      </div>
    </nav>
    <!-- END NAVBAR -->
	<!-- WRAPPER -->
	<div id="wrapper">
		 
		 		 
		<!-- MAIN -->
		<div class="main">
		 
			<!-- MAIN CONTENT -->
			<div class="main-content ">
				<div class="container-fluid ">
					<!--<h3 class="page-title"></h3>-->
					
					<!--search form-->
					<div class="row">
					<div class="form-group">
					<div class="col-sm-1"></div>
						<div class="col-md-10">
							<div class="panel">
								<div class="panel-body">
								<form role="form"  id="forgotFormId"  method="post"  class="form-horizontal"  action="user/forgot">
									<fieldset >
										<div class="form-group">
											<label class="col-sm-4 control-label" for="forgot_phoneId">请输入手机号:</label>
											
											<div class="col-sm-3">
											<input type="text" class="form-control" name="forgot_phone" id="forgot_phoneId"/>
											</div>  
											<div class="col-sm-2">
												<input type="button" class="btn btn-primary " id="forgotId" onclick=" javascript:find();" value="获取手机验证码" />
											</div>
										</div>
									 <div class="form-group">
											<label class="col-sm-4 control-label" for="forgot_phonecodeId">请输入验证码:</label>
											<div class="col-sm-4">
												<input type="text" class="form-control" name="forgot_phonecode" id="forgot_phonecodeId" />
											</div>
										</div> 
										<div class="form-group">
											<label class="col-sm-4 control-label" for="forgot_passwordId">重置密码:</label>
											<div class="col-sm-4">
												<input type="text" class="form-control" name="forgot_password" id="forgot_passwordId"/>
											</div>
										</div> 
										 
										<div class="form-group">
											<div class="col-sm-3">
											</div>
											
											<div class="col-sm-6 ">
												<input type="button" class="btn btn-primary btn-block"    id="forgotId"  onclick=" javascript:forgotdation();" value="重置"    />
											</div>
											
											
										</div>
										
										
									</fieldset>
								</form>
								
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		</div>
		</div>
			<!-- END MAIN CONTENT -->
		<!-- END MAIN -->
		<footer id="footer" >
		<div class="container">
			<div class="row" >
			   <div class="col-sm-12 col-xs-12">Copyright &copy; 2017-2020 杭州数翊信息技术有限公司 版权所有. </div> 
			</div>
		</div>
	</footer>
	
	<!-- END WRAPPER -->
 
		
	<!-- Javascript -->
	<script src="assets/vendor/jquery/jquery.min.js"></script>
	<script src="assets/vendor/jquery/jsrender.js"></script>
	<script src="assets/vendor/bootstrap/js/bootstrap.min.js"></script>
	<script src="assets/vendor/jquery-slimscroll/jquery.slimscroll.min.js"></script>
	<script src="assets/vendor/chartist/js/chartist.min.js"></script>
	<script src="assets/scripts/klorofil-common.js"></script>
<script>




var find = function () {
	var cellPhonePattern = /^\d{11}$/; 
	if (!cellPhonePattern.exec($("#forgot_phoneId").val())){
		alert("手机号码格式有误！");
		$("#forgot_phoneId").parent().addClass("has-error");
		$("#forgot_phoneId").parent().focus();
		$("#forgot_phoneId").change(function(){
			$("#forgot_phoneId").parent().removeClass("has-error");
		});
		return false; 
	}
	 $.ajax({
	       url: "user/find/"+$("#forgot_phoneId").val(),
	       type: "get",
	       async: true,
	       success: function (data) {
	    	   if(data==0){
	    		   alert("手机号有误,发送短信异常");
	    	   }
	    	   else{
	    	   }
	       }
	 });
}

var forgotdation = function(){
	
	var cellPhonePattern = /^\d{11}$/; 
	if (!cellPhonePattern.exec($("#forgot_phoneId").val())){
		alert("手机号码格式有误！");
		$("#forgot_phoneId").parent().addClass("has-error");
		$("#forgot_phoneId").parent().focus();
		$("#forgot_phoneId").change(function(){
			$("#forgot_phoneId").parent().removeClass("has-error");
		});
		return false; 
	}
	
	var passwdPattern = /^([a-zA-Z0-9]|[._&*#@]){6,20}$/; ;
	if (!passwdPattern.exec($("#forgot_passwordId").val())){
		alert("密码为6到20个字符，仅限大小写字母和数字和._&*#@");
		$("#forgot_passwordId").parent().addClass("has-error");
		$("#forgot_passwordId").parent().focus();
		$("#forgot_passwordId").change(function(){
			$("#forgot_passwordId").parent().removeClass("has-error");
		});
		return false; 
	}
	$.ajax({
	      url: "user/findUserByPhone/"+$("#forgot_phoneId").val(),
	      type: "get",
	      async: true,
	      success: function (data) {
	   	   var r =confirm("确认是否更改密码");
	   	   if(r==true){
	        if(data==1){
	       	 alert("手机号未注册，请先注册！");
	       	return false;
	        }
	        
	        else{
	        	$.ajax({
	        	    cache: true,
	        	    type: "post",
	        	    url: "user/forgot",
	        	    data:$("#forgotFormId").serialize(),
	        	    async: true,
	        	    success: function(data) {
	        	      if(data.success==1){
	        	    	  alert(data.msg);
	        	    	  // var result =confirm(data.msg);
	        	    	  window.location.href = "login.html";  
	        	      }else{
	        	    	  alert(data.msg);

	        	      }
	        	    }
	        	});
	        	
	        	
	        }
	   	   }
	   	   else{
	   		return false;
	   	   }
	      }
	      
	        });

}

</script>
</body>
</html>